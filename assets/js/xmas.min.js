var xmas={VERSION:.1};(function(){xmas.webglExperimental=function(){var e,t=document.createElement("canvas"),a=t.getContext("webgl")||t.getContext("experimental-webgl");return e=a?!0:!1}(),xmas.updateHandler={handler:[]},xmas.updateHandler.add=function(e){xmas.updateHandler.handler.push(e)},xmas.updateHandler.excuse=function(){var e,t=xmas.updateHandler.handler.length;for(e=0;t>e;e++)xmas.updateHandler.handler[e]()},xmas.play=function(){xmas.isPaused=!1,xmas.updadeLoop()},xmas.updadeLoop=function(){if(!xmas.isPaused){requestAnimationFrame(xmas.updadeLoop),xmas.world.step(1/60);var e=xmas.clock.getDelta();xmas.clock.getElapsedTime(),xmas.camera.lookAt(xmas.cameraTarget),THREE.AnimationHandler.update(e),xmas.updateHandler.excuse(),xmas.renderer.render(xmas.scene,xmas.camera)}},xmas.onresize=function(){xmas.width=window.innerWidth,xmas.height=window.innerHeight,xmas.renderer.setSize(xmas.width,xmas.height),xmas.camera.aspect=xmas.width/xmas.height,xmas.camera.updateProjectionMatrix()}})(),function(){xmas.init=function(){xmas.width=window.innerWidth,xmas.height=window.innerHeight,xmas.container=document.body,xmas.clock=new THREE.Clock,xmas.cameraTarget=new THREE.Vector3(0,5,0),xmas.scene=new THREE.Scene,xmas.scene.fog=new THREE.FogExp2(15658734,.012),xmas.camera=new THREE.PerspectiveCamera(60,xmas.width/xmas.height,1,300),xmas.camera.position.set(0,10,-40),xmas.camera.lookAt(xmas.cameraTarget);var e=new THREE.AmbientLight(13421772);xmas.scene.add(e);var t=new THREE.SpotLight(16777215,.2);t.position.set(-10,100,10),t.target.position.set(0,0,0),t.castShadow=!0,t.shadowMapWidth=512,t.shadowMapHeight=512,t.shadowCameraFov=60,t.shadowCameraNear=1,t.shadowCameraFar=300,t.shadowBias=-3e-4,t.shadowDarkness=.5,xmas.scene.add(t),xmas.renderer=new THREE.WebGLRenderer,xmas.renderer.setSize(xmas.width,xmas.height),xmas.renderer.shadowMapEnabled=!0,xmas.container.appendChild(xmas.renderer.domElement),xmas.world=new CANNON.World,xmas.world.gravity.set(0,-9.82,0),xmas.world.broadphase=new CANNON.NaiveBroadphase,$(window).on("resize",xmas.onresize)}}(),function(){const e="/assets/model/ground/defuse.jpg";xmas.Ground=function(){this.mesh,this.body=new CANNON.RigidBody(0,new CANNON.Plane),this.body.quaternion.setFromAxisAngle(new CANNON.Vec3(1,0,0),Math.PI/-2),xmas.world.add(this.body),THREE.EventDispatcher.prototype.apply(this)},xmas.Ground.prototype.load=function(){var t,a,s,n=this,o=new $.Deferred,i=new SimplexNoise,d=new THREE.PlaneGeometry(150,150,64,64),r=0,m=function(){r++,r>=2&&(n.dispatchEvent({type:"loaded"}),o.resolve())};for(t=0;d.vertices.length>t;t++)a=d.vertices[t],a.z=i.noise(a.x/10,a.y/10)/3;return d.computeFaceNormals(),d.computeVertexNormals(),s=THREE.ImageUtils.loadTexture(e,void 0,m,m),s.wrapS=s.wrapT=THREE.RepeatWrapping,s.repeat.set(16,16),this.mesh=new THREE.Mesh(d,new THREE.MeshPhongMaterial({specular:3355443,shininess:25,map:s,bumpScale:1})),this.mesh.rotation.x=Math.PI/-2,this.mesh.castShadow=!1,this.mesh.receiveShadow=!0,xmas.scene.add(this.mesh),m(),o.promise()}}(),function(){const e=200,t=["/assets/model/skybox/right.jpg","/assets/model/skybox/left.jpg","/assets/model/skybox/top.jpg","/assets/model/skybox/bottom.jpg","/assets/model/skybox/front.jpg","/assets/model/skybox/back.jpg"];xmas.Skybox=function(){this.mesh,THREE.EventDispatcher.prototype.apply(this)},xmas.Skybox.prototype.load=function(){for(var a,s,n=new $.Deferred,o=0,i=function(){o++,o>=7&&(that.dispatchEvent({type:"loaded"}),n.resolve())},d=[],r=0;6>r;r++)s=THREE.ImageUtils.loadTexture(t[r],i,i),d.push(new THREE.MeshPhongMaterial({map:s,side:THREE.BackSide}));a=new THREE.Mesh(new THREE.CubeGeometry(e,e,e),new THREE.MeshFaceMaterial(d)),this.mesh=a,xmas.scene.add(this.mesh),n.promise()}}(),function(){const e="/assets/model/snow/snowflake.png";xmas.Snow=function(){this.mesh,THREE.EventDispatcher.prototype.apply(this)},xmas.Snow.prototype.load=function(){var t=this,a=new $.Deferred,s=0,n=function(){s++,s>=2&&(t.dispatchEvent({type:"loaded"}),a.resolve(),xmas.updateHandler.add(t.update.bind(t)))},o=THREE.ImageUtils.loadTexture(e,void 0,n,n),d=new THREE.Geometry,r=new THREE.ParticleSystemMaterial({color:16777215,size:1,map:o,blending:THREE.AdditiveBlending,transparent:!0});for(i=0;1e3>i;i++){var m=new THREE.Vector3;m.x=200*Math.random()-100,m.y=100*Math.random(),m.z=200*Math.random()-100,d.vertices.push(m)}return this.mesh=new THREE.ParticleSystem(d,r),xmas.scene.add(this.mesh),n(),a.promise()},xmas.Snow.prototype.update=function(){for(var e,t=this.mesh.geometry.vertices.length;t--;)e=this.mesh.geometry.vertices[t],e.y=0>e.y?100:e.y-.1,e.x=-100>e.x?100:e.x-.05*Math.random();this.mesh.geometry.verticesNeedUpdate=!0}}(),function(){const e="/assets/model/tree/tree.js";xmas.Forrest=function(e){this.mesh,this.body,this._position=e,THREE.EventDispatcher.prototype.apply(this)},xmas.Forrest.prototype.load=function(){var t=this,a=new $.Deferred,s=new THREE.JSONLoader,n=new THREE.Geometry;return s.load(e,function(e,s){var o,i=new THREE.Mesh(e,new THREE.MeshFaceMaterial(s));for(o=0;t._position.length>o;o++)(function(){var e=i.clone();e.position.set(t._position[o].x,0,t._position[o].z),THREE.GeometryUtils.merge(n,e);var a=new CANNON.RigidBody(0,new CANNON.Cylinder(5,5,50,8)),s=new CANNON.Vec3(1,0,0);a.position.set(t._position[o].x,0,t._position[o].z),a.quaternion.setFromAxisAngle(s,Math.PI/-2),t.body=a,xmas.world.add(t.body)})();this.mesh=new THREE.Mesh(n,new THREE.MeshFaceMaterial(s)),xmas.scene.add(this.mesh),t.dispatchEvent({type:"loaded"}),a.resolve(),delete this._position}),a.promise()}}(),function(){const e="/assets/model/box/box.js",t=2.5,a=2.5,s=3;xmas.Box=function(){this.mesh,this.body;var e=new CANNON.Box(new CANNON.Vec3(1.25,1.25,1.25));this.body=new CANNON.RigidBody(s,e),xmas.world.add(this.body),THREE.EventDispatcher.prototype.apply(this),xmas.updateHandler.add(this.update.bind(this))},xmas.Box.prototype.setPosition=function(e,t,a){this.body.position.set(e,t,a),this.update()},xmas.Box.prototype.load=function(){var t=this,a=new $.Deferred,s=new THREE.JSONLoader;return new THREE.Geometry,s.load(e,function(e,s){t.mesh=new THREE.Mesh(e,new THREE.MeshFaceMaterial(s)),xmas.scene.add(t.mesh),t.dispatchEvent({type:"loaded"}),a.resolve()}),a.promise()},xmas.Box.prototype.update=function(){this.body.quaternion.copy(this.mesh.quaternion),this.body.position.copy(this.mesh.position)},xmas.Box.prototype.clone=function(){var e=new xmas.Box;return e.mesh=this.mesh.clone(),xmas.scene.add(e.mesh),e},xmas.Box.WIDTH=t,xmas.Box.HEIGHT=a}(),function(){const e="/assets/model/santa/santa.js",t=80,a=2;xmas.Santa=function(){this.mesh=new THREE.Object3D,this.body,THREE.EventDispatcher.prototype.apply(this),xmas.scene.add(this.mesh),this.body=new CANNON.RigidBody(t,new CANNON.Sphere(a)),this.body.position.set(0,10,0),xmas.world.add(this.body),xmas.updateHandler.add(this.update.bind(this))},xmas.Santa.prototype.load=function(){var t=this,a=new $.Deferred,s=new THREE.JSONLoader;return s.load(e,function(e,s){var n=new THREE.SkinnedMesh(e,new THREE.MeshFaceMaterial(s));n.rotation.y=Math.PI,n.material.materials.forEach(function(e){e.skinning=!0}),n.traverse(function(e){e.castShadow=!0,e.receiveShadow=!1}),THREE.AnimationHandler.add(n.geometry.animations[0]),THREE.AnimationHandler.add(n.geometry.animations[1]),t.motion={idle:new THREE.Animation(n,n.geometry.animations[0].name,THREE.AnimationHandler.CATMULLROM),run:new THREE.Animation(n,n.geometry.animations[1].name,THREE.AnimationHandler.CATMULLROM)},n.position.set(0,-2,0),t.mesh.add(n),t.dispatchEvent({type:"loaded"}),a.resolve()}),a.promise()},xmas.Santa.prototype.update=function(){this.body.position.copy(this.mesh.position)},xmas.Santa.prototype.idle=function(){this.motion.run.stop(),this.motion.idle.play()},xmas.Santa.prototype.run=function(){this.motion.idle.stop(),this.motion.run.play()}}(),function(){const e=20;xmas.KeyInput=function(e){this.player=e,this.disableMovementKey=!1,this.keyInput={up:!1,down:!1,left:!1,right:!1},window.addEventListener("keydown",xmas.KeyInput.onkeydown.bind(this),!1),window.addEventListener("keyup",xmas.KeyInput.onkeyup.bind(this),!1),xmas.updateHandler.add(this.update.bind(this))},xmas.KeyInput.prototype.update=function(){var t=this.keyInput.up,a=this.keyInput.left,s=this.keyInput.right,n=this.keyInput.down,o=0;t||a||!n||s||(o+=0*Math.PI/180),!t&&!a&&n&&s&&(o+=45*Math.PI/180),t||a||n||!s||(o+=90*Math.PI/180),t&&!a&&!n&&s&&(o+=135*Math.PI/180),!t||a||n||s||(o+=180*Math.PI/180),t&&a&&!n&&!s&&(o+=225*Math.PI/180),t||!a||n||s||(o+=270*Math.PI/180),!t&&a&&n&&!s&&(o+=315*Math.PI/180),t||a||n||s?(this.player.mesh.rotation.y=o,this.player.body.velocity.x=-Math.sin(o)*e,this.player.body.velocity.z=-Math.cos(o)*e,this.player.run()):(this.player.body.velocity.x=0,this.player.body.velocity.z=0,this.player.idle())},xmas.KeyInput.onkeydown=function(e){this.disableMovementKey||((87===e.keyCode||38===e.keyCode)&&(this.keyInput.up=!0,this.keyInput.down=!1),(83===e.keyCode||40===e.keyCode)&&(this.keyInput.down=!0,this.keyInput.up=!1),(65===e.keyCode||37===e.keyCode)&&(this.keyInput.left=!0,this.keyInput.right=!1),(68===e.keyCode||39===e.keyCode)&&(this.keyInput.right=!0,this.keyInput.left=!1))},xmas.KeyInput.onkeyup=function(e){87===e.keyCode||38===e.keyCode?this.keyInput.up=!1:83===e.keyCode||40===e.keyCode?this.keyInput.down=!1:65===e.keyCode||37===e.keyCode?this.keyInput.left=!1:(68===e.keyCode||39===e.keyCode)&&(this.keyInput.right=!1)}}();